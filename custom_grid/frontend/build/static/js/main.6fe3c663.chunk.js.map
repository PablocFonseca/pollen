{"version":3,"sources":["Aggrid.tsx","Main.tsx","index.tsx"],"names":["BtnCellRenderer","props","onClick","clicked","value","g_rowdata","AgGrid","defaultColumnDefs","field","pinned","width","headerName","cellRenderer","aggFunc","resizable","cellRendererParams","row","find","item","idx","text","JSON","stringify","navigator","clipboard","writeText","alert","gridRef","useRef","username","api","refresh_sec","refresh_cutoff_sec","useState","rowData","setRowData","columnDefs","useEffect","Streamlit","setFrameHeight","addIds","array","map","fetchAndSetData","a","axios","get","params","then","response","parse","data","idAdded","console","log","current","fetchData","res","timeout","interval","setInterval","setTimeout","clearInterval","error","clearTimeout","useCallback","skipHeader","allColumnIds","columnApi","getColumns","forEach","column","push","getId","autoSizeColumns","sizeColumnsToFit","defaultMinWidth","onGridReady","autoGroupColumnDef","useMemo","minWidth","defaultColDef","sortable","sideBar","id","toolPanels","labelDefault","labelKey","iconKey","toolPanel","defaultToolPanel","className","ref","rowStyle","fontSize","padding","headerHeight","rowHeight","domLayout","enableCellChangeFlash","animateRows","suppressAggFuncInHeader","withStreamlitConnection","args","gridoption_build","Aggrid","engine","Styletron","ReactDOM","render","StrictMode","theme","LightTheme","document","getElementById"],"mappings":"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","file":"static/js/main.6fe3c663.chunk.js","sourcesContent":["import React, { useState, useEffect, useMemo, useRef, useCallback, StrictMode } from 'react';\r\nimport { AgGridReact } from 'ag-grid-react';\r\nimport 'ag-grid-community/styles/ag-grid.css';\r\nimport 'ag-grid-community/styles/ag-theme-alpine.css';\r\nimport './styles.css';\r\nimport axios from \"axios\"\r\nimport {\r\n  ComponentProps,\r\n  Streamlit,\r\n  withStreamlitConnection,\r\n} from \"streamlit-component-lib\";\r\nimport { IOlympicData } from './interfaces';\r\nimport {\r\n  ColDef,\r\n  ColGroupDef,\r\n  ColumnResizedEvent,\r\n  GetRowIdFunc,\r\n  GetRowIdParams,\r\n  Grid,\r\n  GridOptions,\r\n  GridReadyEvent,\r\n  SideBarDef,\r\n  ValueParserParams,\r\n} from 'ag-grid-community';\r\n\r\ntype Props = {\r\n  username: string,\r\n  api: string,\r\n  refresh_sec?: number,\r\n  refresh_cutoff_sec?: number,\r\n  gridoption_build?: any\r\n}\r\n\r\nconst BtnCellRenderer = (props: any) => {\r\n  const btnClickedHandler = () => {\r\n    props.clicked(props.value);\r\n  }\r\n\r\n  return (\r\n    <button onClick={btnClickedHandler}>Click</button>\r\n  )\r\n}\r\n\r\nconst defaultWidth = 100;\r\n\r\n\r\n\r\nlet g_rowdata: any[] = [];\r\n\r\nconst AgGrid = (props: Props) => {\r\n  const defaultColumnDefs: ColDef[] = [\r\n    { field: \"idx\", pinned: \"left\", width: 60 },\r\n    { field: 'honey', headerName: 'honey', width: defaultWidth, pinned: 'left', cellRenderer: 'agAnimateShowChangeCellRenderer', aggFunc: \"sum\" },\r\n    { field: '$honey', headerName: '$honey', width: defaultWidth, resizable: true },\r\n    { field: 'symbol', headerName: 'Symbol', width: defaultWidth, resizable: true },\r\n    { field: 'ticker_time_frame', headerName: 'ticker_time_frame', width: defaultWidth, resizable: true },\r\n    { field: 'trigname', headerName: 'trigname', width: defaultWidth, resizable: true },\r\n    { field: 'datetime', headerName: 'datetime', width: defaultWidth, resizable: true },\r\n    { field: 'honey_time_in_profit', headerName: 'honey_time_in_profit', width: defaultWidth, resizable: true },\r\n    { field: 'filled_qty', headerName: 'filled_qty', width: defaultWidth, resizable: true },\r\n    { field: 'qty_available', headerName: 'qty_available', width: defaultWidth, resizable: true },\r\n    { field: 'filled_avg_price', headerName: 'filled_avg_price', width: defaultWidth, resizable: true },\r\n    { field: 'limit_price', headerName: 'limit_price', width: defaultWidth, resizable: true },\r\n    { field: 'cost_basis', headerName: 'cost_basis', width: defaultWidth, resizable: true },\r\n    { field: 'wave_amo', headerName: 'wave_amo', width: defaultWidth, resizable: true },\r\n    { field: 'status_q', headerName: 'status_q', width: defaultWidth, resizable: true },\r\n    { field: 'client_order_id', headerName: 'client_order_id', width: defaultWidth, resizable: true },\r\n    { field: 'origin_wave', headerName: 'origin_wave', width: defaultWidth, resizable: true },\r\n    { field: 'wave_at_creation', headerName: 'wave_at_creation', width: defaultWidth, resizable: true },\r\n    { field: 'sell_reason', headerName: 'sell_reason', width: defaultWidth, resizable: true },\r\n    { field: 'exit_order_link', headerName: 'exit_order_link', width: defaultWidth, resizable: true },\r\n    { field: 'queen_order_state', headerName: 'queen_order_state', width: defaultWidth, resizable: true },\r\n    { field: 'order_rules', headerName: 'order_rules', width: defaultWidth, resizable: true },\r\n    { field: 'order_rules.sellout', headerName: 'order_rules.sellout', width: 150, resizable: true },\r\n    { field: 'order_trig_sell_stop', headerName: 'order_trig_sell_stop', width: defaultWidth, resizable: true },\r\n    { field: 'side', headerName: 'side', width: 70, pinned: 'right', resizable: true },\r\n    {\r\n      field: \"idx\",\r\n      headerName: 'action',\r\n      width: 80,\r\n      cellRenderer: BtnCellRenderer,\r\n      cellRendererParams: {\r\n        clicked: function (field: any) {\r\n          const row = g_rowdata.find((item) => item.idx == field);\r\n          const text = JSON.stringify(row);\r\n          navigator.clipboard.writeText(text);\r\n          alert(text)\r\n        },\r\n      },\r\n      pinned: 'right',\r\n    }\r\n  ];\r\n  const gridRef = useRef<any>();\r\n  const { username, api, refresh_sec = 1, refresh_cutoff_sec = 0 } = props;\r\n  const [rowData, setRowData] = useState<any[]>([]);\r\n  const [columnDefs, setColumnDefs] = useState<(ColDef | ColGroupDef)[]>(defaultColumnDefs)\r\n  useEffect(() => Streamlit.setFrameHeight());\r\n\r\n  const addIds = (array: any[]) => {\r\n    return array.map((item, idx) => {\r\n      return { ...item, idx }\r\n    })\r\n  }\r\n  const fetchAndSetData = async () => {\r\n    axios.get(api, {\r\n      params: {\r\n        username: username\r\n      }\r\n    }).then((response) => {\r\n      const array = JSON.parse(response.data);\r\n      const idAdded = addIds(array)\r\n      console.log(\"idAdded\", idAdded);\r\n      gridRef.current!.api.setRowData(idAdded);\r\n      console.log('response.data :>> ', array);\r\n      g_rowdata = idAdded;\r\n    });\r\n  };\r\n\r\n  const fetchData = async () => {\r\n    const res = await axios.get(api, {\r\n      params: {\r\n        username: username\r\n      }\r\n    });\r\n    const array = JSON.parse(res.data);\r\n    const idAdded = addIds(array)\r\n    g_rowdata = idAdded;\r\n    return idAdded;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(fetchAndSetData, refresh_sec * 1000);\r\n    let timeout: NodeJS.Timeout;\r\n    if (refresh_cutoff_sec > 0) {\r\n      console.log(refresh_cutoff_sec);\r\n      timeout = setTimeout(() => {\r\n        clearInterval(interval);\r\n        console.log(\"Fetching data ended, refresh rate:\", refresh_sec);\r\n      }, refresh_cutoff_sec * 1000);\r\n    }\r\n    console.error(\"rendered==========\", props);\r\n    return () => {\r\n      clearInterval(interval);\r\n      if (timeout) clearTimeout(timeout);\r\n    }\r\n  }, [props]);\r\n\r\n  const autoSizeAll = useCallback((skipHeader: boolean) => {\r\n    const allColumnIds: string[] = [];\r\n    gridRef.current!.columnApi.getColumns()!.forEach((column: any) => {\r\n      allColumnIds.push(column.getId());\r\n    });\r\n    gridRef.current!.columnApi.autoSizeColumns(allColumnIds, skipHeader);\r\n  }, []);\r\n\r\n  const sizeToFit = useCallback(() => {\r\n    gridRef.current.api.sizeColumnsToFit({\r\n      defaultMinWidth: 100,\r\n    });\r\n  }, []);\r\n\r\n  const onGridReady = useCallback(async (params: GridReadyEvent) => {\r\n    setTimeout(async () => {\r\n      const data = await fetchData();\r\n      setRowData(data);\r\n    }, 100);\r\n  }, []);\r\n\r\n  const autoGroupColumnDef = useMemo<ColDef>(() => {\r\n    return {\r\n      minWidth: 200,\r\n    };\r\n  }, []);\r\n\r\n  const defaultColDef = useMemo<ColDef>(() => {\r\n    return {\r\n      width: 120,\r\n      sortable: true,\r\n      resizable: true,\r\n    };\r\n  }, []);\r\n\r\n  const getRowId = useMemo<GetRowIdFunc>(() => {\r\n    return (params: GetRowIdParams<any>) => params.data.id;\r\n  }, []);\r\n\r\n  const sideBar = useMemo<\r\n    SideBarDef | string | string[] | boolean | null\r\n  >(() => {\r\n    return {\r\n      toolPanels: [\r\n        {\r\n          id: 'columns',\r\n          labelDefault: 'Columns',\r\n          labelKey: 'columns',\r\n          iconKey: 'columns',\r\n          toolPanel: 'agColumnsToolPanel',\r\n        },\r\n        {\r\n          id: 'filters',\r\n          labelDefault: 'Filters',\r\n          labelKey: 'filters',\r\n          iconKey: 'filter',\r\n          toolPanel: 'agFiltersToolPanel',\r\n        },\r\n      ],\r\n      defaultToolPanel: 'customStats',\r\n    };\r\n  }, []);\r\n  return (\r\n    <div\r\n      className=\"ag-theme-alpine-dark\"\r\n    >\r\n      <AgGridReact\r\n        ref={gridRef}\r\n        rowData={rowData}\r\n        columnDefs={columnDefs}\r\n        defaultColDef={defaultColDef}\r\n        rowStyle={{ fontSize: 12, padding: 0 }}\r\n        headerHeight={30}\r\n        rowHeight={30}\r\n        domLayout={\"autoHeight\"}\r\n        onGridReady={onGridReady}\r\n        autoGroupColumnDef={autoGroupColumnDef}\r\n        sideBar={sideBar}\r\n        enableCellChangeFlash={true}\r\n        animateRows={true}\r\n        suppressAggFuncInHeader={true}\r\n      // getRowId={getRowId}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AgGrid;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  ComponentProps,\r\n  Streamlit,\r\n  withStreamlitConnection,\r\n} from \"streamlit-component-lib\";\r\nimport { Slider } from \"baseui/slider\";\r\nimport { setTimeout } from \"timers\";\r\nimport { AgGridReact } from 'ag-grid-react';\r\nimport 'ag-grid-community/styles/ag-grid.css';\r\nimport 'ag-grid-community/styles/ag-theme-alpine.css';\r\nimport axios from \"axios\";\r\nimport Aggrid from \"./Aggrid\";\r\n\r\nconst Main = (props: ComponentProps) => {\r\n\r\n  const { username, api, refresh_sec, refresh_cutoff_sec, gridoption_build } = props.args;\r\n\r\n  useEffect(() => Streamlit.setFrameHeight());\r\n  // Add a label and pass min/max variables to the baseui Slider\r\n  return (\r\n    <>\r\n      <Aggrid\r\n        username={username}\r\n        api={api}\r\n        refresh_sec={refresh_sec}\r\n        refresh_cutoff_sec={refresh_cutoff_sec}\r\n        gridoption_build={gridoption_build}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default withStreamlitConnection(Main);\r\n","import React from \"react\"\r\nimport ReactDOM from \"react-dom\"\r\nimport Main from \"./Main\"\r\n// Lots of import to define a Styletron engine and load the light theme of baseui\r\nimport { Client as Styletron } from \"styletron-engine-atomic\"\r\nimport { Provider as StyletronProvider } from \"styletron-react\"\r\nimport { ThemeProvider, LightTheme } from \"baseui\"\r\n\r\nconst engine = new Styletron()\r\n\r\n// Wrap your CustomSlider with the baseui them\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <StyletronProvider value={engine}>\r\n      <ThemeProvider theme={LightTheme}>\r\n        <Main />\r\n      </ThemeProvider>\r\n    </StyletronProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n)\r\n"],"sourceRoot":""}