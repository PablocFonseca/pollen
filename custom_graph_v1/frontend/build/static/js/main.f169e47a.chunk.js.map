{"version":3,"sources":["Main.jsx","index.tsx"],"names":["CanvasJSChart","CanvasJSReact","CanvasJS","dataPoints","toastr","options","positionClass","hideDuration","timeOut","App","Component","constructor","props","super","this","updateChart","bind","toggleDataSeries","componentDidMount","kwargs","args","y_axis","api","y_max","refresh_sec","graph_height","Streamlit","setFrameHeight","setInterval","e","dataSeries","visible","chart","render","res","axios","post","JSON","parse","data","x_axis","refresh_button","theme_options","fetchGraphData","newSeries","map","axis","y_index","row","index","length","x","y","indexLabel","toFixed","indexLabelFontColor","item","pop","console","log","push","legendText","success","error","concat","message","colorSet","dataY","type","xValueFormatString","yValueFormatString","showInLegend","name","addColorSet","backgroundColor","zoomEnabled","title","text","axisX","labelFormatter","moment","value","format","labelFontSize","axisY","suffix","maximum","gridColor","toolTip","shared","contentFormatter","content","formattedXValue","entries","dataPoint","i","entry","color","legend","cursor","verticalAlign","fontSize","fontColor","itemclick","height","React","createElement","style","display","margin","className","onClick","onRef","ref","withStreamlitConnection","ReactDOM","StrictMode","Main","document","getElementById"],"mappings":"+QAeIA,EAAgBC,IAAcD,cAC9BE,EAAWD,IAAcC,SAC7B,MAAMC,EAAa,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAExDC,IAAOC,QAAU,CACfC,cAAe,uBACfC,aAAc,IACdC,QAAS,KAGX,MAAMC,UAAYC,YAChBC,YAAYC,GACVC,MAAMD,GACNE,KAAKC,YAAcD,KAAKC,YAAYC,KAAKF,MACzCA,KAAKG,iBAAmBH,KAAKG,iBAAiBD,KAAKF,MAErDI,oBACE,MAAM,OAAEC,GAAWL,KAAKF,MAAMQ,MACxB,OAAEC,EAAM,IAAEC,EAAG,MAAEC,EAAK,YAAEC,EAAW,aAAEC,GAAiBN,EAC1DO,IAAUC,iBACVb,KAAKC,cACDS,GAAaI,YAAYd,KAAKC,YAA2B,IAAdS,GAEjDP,iBAAiBY,GACqB,qBAAzBA,EAAEC,WAAWC,SAA2BF,EAAEC,WAAWC,QAC9DF,EAAEC,WAAWC,SAAU,EAEvBF,EAAEC,WAAWC,SAAU,EAEzBjB,KAAKkB,MAAMC,SAEb,uBACE,MAAM,OAAEd,GAAWL,KAAKF,MAAMQ,MACxB,OAAEC,EAAM,IAAEC,EAAG,MAAEC,EAAK,YAAEC,GAAgBL,EACtCe,QAAYC,IAAMC,KAAKd,EAAK,IAAKH,IACvC,OAAOkB,KAAKC,MAAMJ,EAAIK,MAExB,oBACE,MAAM,OAAEpB,GAAWL,KAAKF,MAAMQ,MACxB,OACJoB,EAAM,OACNnB,EAAM,IACNC,EAAG,MACHC,EAAK,YACLC,EAAW,eACXiB,EAAc,cACdC,GACEvB,EACJ,IACE,MAAMoB,QAAazB,KAAK6B,iBAClBC,EAAY,GAuBlB,IAtBAvB,EAAOwB,IAAI,CAACC,EAAMC,IACRH,EAAUG,GAAWR,EAAKM,IAAI,CAACG,EAAKC,IACtCA,GAASV,EAAKW,OAAS,GAAKR,EAAmC,oBAC1D,CACLS,EAAGH,EAAIR,EAAc,OACrBY,EAAGJ,EAAIF,EAAY,OACnBO,WACEP,EAAW,KACX,IACAE,EAAIF,EAAY,OAAGQ,QAAQ,GAC3B,8BACFC,oBAAqBT,EAAY,OAG5B,CACLK,EAAGH,EAAIR,EAAc,OACrBY,EAAGJ,EAAIF,EAAY,UAMpB3C,EAAW,GAAG+C,QACnB7B,EAAOwB,IAAI,CAACW,EAAMP,KAChB9C,EAAW8C,GAAOQ,QAGtBC,QAAQC,IAAI,iBAAkBxD,GAC9BkB,EAAOwB,IAAI,CAACW,EAAMP,KAChB9C,EAAW8C,GAAOW,QAAQhB,EAAUK,IACpCnC,KAAKkB,MAAM3B,QAAQkC,KAAKU,GAAOY,WAC7BL,EAAW,KAAIZ,EAAUK,GAAOQ,MAAML,IAE1CtC,KAAKkB,MAAMC,SACXQ,IAAmBjB,GAAepB,IAAO0D,QAAQ,YACjD,MAAOC,GACPtB,IACGjB,GACDpB,IAAO2D,MAAM,gBAADC,OAAiBD,EAAME,WAIzChC,SACE,MAAMiC,EAAW,IACX,OAAE/C,GAAWL,KAAKF,MAAMQ,MACxB,OAAEC,EAAM,IAAEC,EAAG,MAAEC,EAAK,YAAEC,EAAW,cAAEkB,EAAa,eAAED,GACtDtB,EACIgD,EAAQ9C,EAAOwB,IAAI,CAACW,EAAMP,KAC9BiB,EAASN,KAAKJ,EAAY,OACnB,CACLY,KAAM,SACNC,mBAAoB,SACpBC,mBAAoB,QACpBC,aAAc7B,EAA4B,aAC1C8B,KAAMhB,EAAW,KACjBrD,WAAYA,EAAW8C,MAI3B/C,EAASuE,YAAY,cAAeP,GACpC,MAAM7D,EAAU,CACd6D,SAAU,cACVQ,gBAAiBhC,EAA+B,gBAC5CA,EAA+B,gBAC/B,QACJiC,aAAa,EACbC,MAAO,CACLC,KAAMnC,EAA0B,WAAIA,EAA0B,WAAI,IAEpEoC,MAAO,CACLF,MAAOlC,EAA4B,aAC/BA,EAA4B,aAC5B,GACJqC,eAAiBlD,GAAMmD,IAAOnD,EAAEoD,OAAOC,OAAO,iBAC9CC,cAAe,IAEjBC,MAAO,CACLC,OAAQ,GACRC,QAAS/D,GAAgB,KACzBgE,UAAW7C,EAA0B,WACjCA,EAA0B,WAC1B,IAEN8C,QAAS,CACPC,QAAQ,EACRC,iBAAkB,SAAU7D,GACxB,IAAI8D,EAAU,GAGd,MAAMC,EAAkBZ,IAAOnD,EAAEgE,QAAQ,GAAGC,UAAU3C,GAAG+B,OAAO,oBAChES,GAAO,0BAAA3B,OAA8B4B,EAAe,SAGpD,IAAK,IAAIG,EAAI,EAAGA,EAAIlE,EAAEgE,QAAQ3C,OAAQ6C,IAAK,CACvC,MAAMC,EAAQnE,EAAEgE,QAAQE,GAClBjE,EAAakE,EAAMlE,WACnBgE,EAAYE,EAAMF,UAClBG,EAAQnE,EAAWmE,MAAQnE,EAAWmE,MAAQnE,EAAWzB,QAAQ4F,MACvEN,GAAO,yBAAA3B,OAA6BiC,EAAK,MAAAjC,OAAKlC,EAAW0C,KAAI,eAAAR,OAAc8B,EAAU1C,EAAC,SAG1F,OAAOuC,IAGbO,OAAQ,CACNC,OAAQ,UACRC,cAAe,MACfC,SAAU,GACVC,UAAW,UACXC,UAAWzF,KAAKG,kBAElBsB,KAAM4B,EACNqC,OAAQrF,EAAOM,aAAeN,EAAOM,aAAe,KAEtD,OACEgF,IAAAC,cAAA,WACGjE,IAAmBjB,GAClBiF,IAAAC,cAAA,OAAKC,MAAO,CAAEC,QAAS,SACrBH,IAAAC,cAAA,OAAKC,MAAO,CAAEE,OAAQ,uBACpBJ,IAAAC,cAAA,UAAQI,UAAU,kBAAkBC,QAASjG,KAAKC,aAAa,aAMrE0F,IAAAC,cAAC1G,EAAa,CAACK,QAASA,EAAS2G,MAAQC,GAASnG,KAAKkB,MAAQiF,MAMxDC,kBAAwBzG,GCjMvC0G,IAASlF,OACPwE,IAAAC,cAACD,IAAMW,WAAU,KACfX,IAAAC,cAACW,EAAI,OAEPC,SAASC,eAAe,W","file":"static/js/main.f169e47a.chunk.js","sourcesContent":["import React, { Component } from \"react\"\r\nimport CanvasJSReact from \"@canvasjs/react-charts\"\r\nimport moment from \"moment\"\r\n\r\nimport {\r\n  ComponentProps,\r\n  Streamlit,\r\n  withStreamlitConnection,\r\n} from \"streamlit-component-lib\"\r\n\r\nimport toastr from \"toastr\"\r\nimport \"toastr/build/toastr.min.css\"\r\n\r\nimport axios from \"axios\"\r\n\r\nvar CanvasJSChart = CanvasJSReact.CanvasJSChart\r\nvar CanvasJS = CanvasJSReact.CanvasJS\r\nconst dataPoints = [[], [], [], [], [], [], [], [], [], []]\r\n\r\ntoastr.options = {\r\n  positionClass: \"toast-top-full-width\",\r\n  hideDuration: 300,\r\n  timeOut: 3000,\r\n}\r\n\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.updateChart = this.updateChart.bind(this)\r\n    this.toggleDataSeries = this.toggleDataSeries.bind(this)\r\n  }\r\n  componentDidMount() {\r\n    const { kwargs } = this.props.args\r\n    const { y_axis, api, y_max, refresh_sec, graph_height } = kwargs\r\n    Streamlit.setFrameHeight()\r\n    this.updateChart()\r\n    if (refresh_sec) setInterval(this.updateChart, refresh_sec * 1000)\r\n  }\r\n  toggleDataSeries(e) {\r\n    if (typeof e.dataSeries.visible === \"undefined\" || e.dataSeries.visible) {\r\n      e.dataSeries.visible = false\r\n    } else {\r\n      e.dataSeries.visible = true\r\n    }\r\n    this.chart.render()\r\n  }\r\n  async fetchGraphData() {\r\n    const { kwargs } = this.props.args\r\n    const { y_axis, api, y_max, refresh_sec } = kwargs\r\n    const res = await axios.post(api, { ...kwargs })\r\n    return JSON.parse(res.data)\r\n  }\r\n  async updateChart() {\r\n    const { kwargs } = this.props.args\r\n    const {\r\n      x_axis,\r\n      y_axis,\r\n      api,\r\n      y_max,\r\n      refresh_sec,\r\n      refresh_button,\r\n      theme_options,\r\n    } = kwargs\r\n    try {\r\n      const data = await this.fetchGraphData()\r\n      const newSeries = []\r\n      y_axis.map((axis, y_index) => {\r\n        return (newSeries[y_index] = data.map((row, index) => {\r\n          if (index == data.length - 1 && theme_options[\"showInLegendPerLine\"])\r\n            return {\r\n              x: row[x_axis[\"field\"]],\r\n              y: row[axis[\"field\"]],\r\n              indexLabel:\r\n                axis[\"name\"] +\r\n                \" \" +\r\n                row[axis[\"field\"]].toFixed(3) +\r\n                \"                        \\n.\",\r\n              indexLabelFontColor: axis[\"color\"],\r\n            }\r\n          else {\r\n            return {\r\n              x: row[x_axis[\"field\"]],\r\n              y: row[axis[\"field\"]],\r\n            }\r\n          }\r\n        }))\r\n      })\r\n\r\n      while (dataPoints[0].length) {\r\n        y_axis.map((item, index) => {\r\n          dataPoints[index].pop()\r\n        })\r\n      }\r\n      console.log(\"fetchGraphData\", dataPoints)\r\n      y_axis.map((item, index) => {\r\n        dataPoints[index].push(...newSeries[index])\r\n        this.chart.options.data[index].legendText =\r\n          item[\"name\"] + newSeries[index].pop().y\r\n      })\r\n      this.chart.render()\r\n      refresh_button && !refresh_sec && toastr.success(`Success!`)\r\n    } catch (error) {\r\n      refresh_button &&\r\n        !refresh_sec &&\r\n        toastr.error(`Fetch Error: ${error.message}`)\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const colorSet = []\r\n    const { kwargs } = this.props.args\r\n    const { y_axis, api, y_max, refresh_sec, theme_options, refresh_button } =\r\n      kwargs\r\n    const dataY = y_axis.map((item, index) => {\r\n      colorSet.push(item[\"color\"])\r\n      return {\r\n        type: \"spline\",\r\n        xValueFormatString: \"#.##0 \",\r\n        yValueFormatString: \"#.##0\",\r\n        showInLegend: theme_options[\"showInLegend\"],\r\n        name: item[\"name\"],\r\n        dataPoints: dataPoints[index],\r\n        // lineColor: item['color'] ? item['color'] : ''\r\n      }\r\n    })\r\n    CanvasJS.addColorSet(\"greenShades\", colorSet)\r\n    const options = {\r\n      colorSet: \"greenShades\",\r\n      backgroundColor: theme_options[\"backgroundColor\"]\r\n        ? theme_options[\"backgroundColor\"]\r\n        : \"white\",\r\n      zoomEnabled: true,\r\n      title: {\r\n        text: theme_options[\"main_title\"] ? theme_options[\"main_title\"] : \"\",\r\n      },\r\n      axisX: {\r\n        title: theme_options[\"x_axis_title\"]\r\n          ? theme_options[\"x_axis_title\"]\r\n          : \"\",\r\n        labelFormatter: (e) => moment(e.value).format(\"DD/MM/YYYY hh\"),\r\n        labelFontSize: 12,\r\n      },\r\n      axisY: {\r\n        suffix: \"\",\r\n        maximum: y_max ? y_max : null,\r\n        gridColor: theme_options[\"grid_color\"]\r\n          ? theme_options[\"grid_color\"]\r\n          : \"\",\r\n      },\r\n      toolTip: {\r\n        shared: true,\r\n        contentFormatter: function (e) {\r\n            let content = \"\";\r\n    \r\n            // Format the x-axis time and add it to the tooltip content\r\n            const formattedXValue = moment(e.entries[0].dataPoint.x).format(\"DD/MM/YYYY HH:mm\");\r\n            content += `<strong>Date</strong>: ${formattedXValue}<br/>`;\r\n    \r\n            // Loop through other data points (excluding the x-axis time) and add them to the tooltip content\r\n            for (let i = 1; i < e.entries.length; i++) {\r\n                const entry = e.entries[i];\r\n                const dataSeries = entry.dataSeries;\r\n                const dataPoint = entry.dataPoint;\r\n                const color = dataSeries.color ? dataSeries.color : dataSeries.options.color;\r\n                content += `<strong style=\"color: ${color}\">${dataSeries.name}</strong>: ${dataPoint.y}<br/>`;\r\n            }\r\n    \r\n            return content;\r\n        }\r\n    },\r\n      legend: {\r\n        cursor: \"pointer\",\r\n        verticalAlign: \"top\",\r\n        fontSize: 18,\r\n        fontColor: \"dimGrey\",\r\n        itemclick: this.toggleDataSeries,\r\n      },\r\n      data: dataY,\r\n      height: kwargs.graph_height ? kwargs.graph_height : 400,\r\n    }\r\n    return (\r\n      <div>\r\n        {refresh_button && !refresh_sec && (\r\n          <div style={{ display: \"flex\" }}>\r\n            <div style={{ margin: \"10px 10px 10px 2px\" }}>\r\n              <button className=\"btn btn-warning\" onClick={this.updateChart}>\r\n                Refresh\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <CanvasJSChart options={options} onRef={(ref) => (this.chart = ref)} />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default withStreamlitConnection(App)\r\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport Main from \"./Main\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <Main />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}